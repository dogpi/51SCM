C51 COMPILER V9.01   MAIN                                                                  08/23/2016 13:46:53 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: J:\mdk4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             NE555脉冲发生器实验                                                                                                 *
   3          实现现象：下载程序后，按照视频操作正确接线，数码管显示接收到的脉冲频率
   4          注意事项：      将NE555模块的短接片J11短接起来                                                                                                                                                    
   5          ***************************************************************************************/
   6          
   7          #include "reg52.h"                       //此文件中定义了单片机的一些特殊功能寄存器
   8          
   9          typedef unsigned int u16;         //对数据类型进行声明定义
  10          typedef unsigned char u8;
  11          
  12          
  13          
  14          //--定义使用的IO--//
  15          #define GPIO_DIG P0
  16          
  17          sbit LSA=P2^2;
  18          sbit LSB=P2^3;
  19          sbit LSC=P2^4;
  20          
  21          
  22          u8 code smgduan[17]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  23                                                  0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//显示0~F的值
  24          
  25          u8 DisplayData[8];
  26          
  27          //--定义全局变量--//
  28          unsigned long   Freq;        //用来存放要显示的频率值
  29          unsigned long   TimeCount;   //用于计算1S钟的
  30          
  31          
  32          /*******************************************************************************
  33          * 函 数 名         : delay
  34          * 函数功能                 : 延时函数，i=1时，大约延时10us
  35          *******************************************************************************/
  36          void delay(u16 i)
  37          {
  38   1              while(i--);     
  39   1      }
  40          
  41          /*******************************************************************************
  42          * 函 数 名         : DigDisplay
  43          * 函数功能                 : 数码管动态扫描函数，循环扫描8个数码管显示
  44          *******************************************************************************/
  45          void DigDisplay()
  46          {
  47   1              u8 i;
  48   1              for(i=0;i<8;i++)
  49   1              {
  50   2                      switch(i)        //位选，选择点亮的数码管，
  51   2                      {
  52   3                              case(0):
  53   3                                      LSA=0;LSB=0;LSC=0; break;//显示第0位
  54   3                              case(1):
  55   3                                      LSA=1;LSB=0;LSC=0; break;//显示第1位
C51 COMPILER V9.01   MAIN                                                                  08/23/2016 13:46:53 PAGE 2   

  56   3                              case(2):
  57   3                                      LSA=0;LSB=1;LSC=0; break;//显示第2位
  58   3                              case(3):
  59   3                                      LSA=1;LSB=1;LSC=0; break;//显示第3位
  60   3                              case(4):
  61   3                                      LSA=0;LSB=0;LSC=1; break;//显示第4位
  62   3                              case(5):
  63   3                                      LSA=1;LSB=0;LSC=1; break;//显示第5位
  64   3                              case(6):
  65   3                                      LSA=0;LSB=1;LSC=1; break;//显示第6位
  66   3                              case(7):
  67   3                                      LSA=1;LSB=1;LSC=1; break;//显示第7位    
  68   3                      }
  69   2                      GPIO_DIG=DisplayData[i];//发送段码
  70   2                      delay(10); //间隔一段时间扫描   
  71   2                      GPIO_DIG=0x00;//消隐
  72   2              }
  73   1      }
  74          
  75          
  76          /*******************************************
  77          *函数名         ：TIMER_Configuration
  78          *功  能         ：配置定时/计数器T0和T1
  79          *输      入     ：无
  80          *输  出         ：无
  81          *******************************************/
  82          
  83          void Timer_Config()
  84          {
  85   1              //--定时器T1做计数器，工作方式1（16位定时器），只由TRx打开计数器--//
  86   1              //--定时器T0做定时器，工作方式1（16位定时器），只由TRx打开定时器--//    
  87   1              TMOD=0x51;
  88   1      
  89   1              //--设置定时器晶振为12MHZ时定时50ms--//
  90   1              TH0=0x3C;
  91   1              TL0=0xB0;
  92   1      
  93   1              //--打开中断-//
  94   1              ET0=1;
  95   1              ET1=1;
  96   1              EA=1;
  97   1      
  98   1              //--打开定时器*/
  99   1              TR0=1;
 100   1              TR1=1;
 101   1      }
 102          
 103          /*******************************************************************************
 104          * 函 数 名       : main
 105          * 函数功能               : 主函数
 106          * 输    入       : 无
 107          * 输    出       : 无
 108          *******************************************************************************/
 109          void main()
 110          {       
 111   1              Timer_Config();
 112   1              
 113   1              while(1)
 114   1              {
 115   2                      if(TR1 == 0)         //当计数器停下的时候，表明计数完毕
 116   2                      {
 117   3                              Freq = Freq + TL1;         //读取TL的值
C51 COMPILER V9.01   MAIN                                                                  08/23/2016 13:46:53 PAGE 3   

 118   3                              Freq = Freq + (TH1 * 256); //读取TH的值
 119   3      
 120   3                              //--求频率的个十百千万十万位--//
 121   3                              DisplayData[0] = smgduan[Freq%1000000/100000];  
 122   3                              DisplayData[1] = smgduan[Freq%100000/10000];    
 123   3                              DisplayData[2] = smgduan[Freq%10000/1000];      
 124   3                              DisplayData[3] = smgduan[Freq%1000/100];        
 125   3                              DisplayData[4] = smgduan[Freq%100/10];  
 126   3                              DisplayData[5] = smgduan[Freq%10];
 127   3                              
 128   3                              //--显示完，重新计算下一次频率。--//    
 129   3                              Freq = 0;//将计算的频率清零
 130   3                              TH1 = 0; //将计数器的值清零
 131   3                              TL1 = 0;
 132   3                              TR0 = 1; //开启定时器
 133   3                              TR1 = 1; //开启计数器   
 134   3                      }
 135   2      
 136   2                      //--显示求得的数值--//
 137   2                      DigDisplay();
 138   2              }                               
 139   1      }
 140          
 141          
 142          /*******************************************
 143          *函数名         ：Timer0
 144          *功  能         ：定时器0的中断函数
 145          *输      入     ：无
 146          *输  出         ：无
 147          *******************************************/
 148          
 149          void Timer0() interrupt 1
 150          {
 151   1              //--12MHZ设置定时50ms的初值--//
 152   1              TH0=0x3C;
 153   1              TL0=0xB0;
 154   1              
 155   1              TimeCount++;
 156   1              if(TimeCount==20)//计时到1S
 157   1              {
 158   2                      TR0=0;
 159   2                      TR1=0;
 160   2                      TimeCount=0;            
 161   2              }               
 162   1      }
 163          /*******************************************
 164          *函数名         ：Timer1
 165          *功  能         ：定时器1的中断函数
 166          *输      入     ：无
 167          *输  出         ：无
 168          *******************************************/
 169          
 170          void Timer1() interrupt 3
 171          {       
 172   1              //--进入一次中断，表明计数到了65536--//
 173   1              Freq=Freq+65536;                
 174   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    647    ----
   CONSTANT SIZE    =     17    ----
C51 COMPILER V9.01   MAIN                                                                  08/23/2016 13:46:53 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
