C51 COMPILER V9.01   MAIN                                                                  08/23/2016 14:42:02 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: J:\mdk4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             EEPROM-IIC实验                                                                                              *
   3          实现现象：具体接线操作请看视频。
   4                            下载程序后数码管后4位显示0，按K1保存显示的数据，按K2读取上次保存的数据，
   5                            按K3显示数据加一，按K4显示数据清零。最大能写入的数据是255.
   6                            
   7          注意事项：由于P3.2口跟红外线共用，所以做按键实验时为了不让红外线影响实验效果，最好把红外线先取下来。                                            
             -                                                                                                                  
   8          ***************************************************************************************/
   9          
  10          #include "reg52.h"                       //此文件中定义了单片机的一些特殊功能寄存器
  11          #include "i2c.h"        
  12          
  13          typedef unsigned int u16;         //对数据类型进行声明定义
  14          typedef unsigned char u8;
  15          
  16          sbit LSA=P2^2;
  17          sbit LSB=P2^3;
  18          sbit LSC=P2^4;
  19          
  20          sbit k1=P3^1;
  21          sbit k2=P3^0;
  22          sbit k3=P3^2;
  23          sbit k4=P3^3;    //定义按键端口
  24          
  25          char num=0;
  26          u8 disp[4];
  27          u8 code smgduan[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  28          
  29          /*******************************************************************************
  30          * 函 数 名         : delay
  31          * 函数功能                 : 延时函数，i=1时，大约延时10us
  32          *******************************************************************************/
  33          void delay(u16 i)
  34          {
  35   1              while(i--);     
  36   1      }
  37          
  38          
  39          /*******************************************************************************
  40          * 函数名         :Keypros()
  41          * 函数功能               :按键处理函数
  42          * 输入           : 无
  43          * 输出           : 无
  44          *******************************************************************************/
  45          void Keypros()
  46          {
  47   1              if(k1==0)
  48   1              {
  49   2                      delay(1000);  //消抖处理
  50   2                      if(k1==0)
  51   2                      {
  52   3                              At24c02Write(1,num);   //在地址1内写入数据num
  53   3                      }
  54   2                      while(!k1);
C51 COMPILER V9.01   MAIN                                                                  08/23/2016 14:42:02 PAGE 2   

  55   2              }
  56   1              if(k2==0)
  57   1              {
  58   2                      delay(1000);  //消抖处理
  59   2                      if(k2==0)
  60   2                      {
  61   3                              num=At24c02Read(1);       //读取EEPROM地址1内的数据保存在num中
  62   3                      }
  63   2                      while(!k2);
  64   2              }
  65   1              if(k3==0)
  66   1              {
  67   2                      delay(100);  //消抖处理
  68   2                      if(k3==0)
  69   2                      {
  70   3                              num++;     //数据加1
  71   3                              if(num>255)num=0;
  72   3                      }
  73   2                      while(!k3);
  74   2              }
  75   1              if(k4==0)
  76   1              {
  77   2                      delay(1000);  //消抖处理
  78   2                      if(k4==0)
  79   2                      {
  80   3                              num=0;           //数据清零
  81   3                      }
  82   2                      while(!k4);
  83   2              }               
  84   1      }
  85          
  86          /*******************************************************************************
  87          * 函数名         :datapros()
  88          * 函数功能               :数据处理函数
  89          * 输入           : 无
  90          * 输出           : 无
  91          *******************************************************************************/
  92          void datapros()
  93          {
  94   1              disp[0]=smgduan[num/1000];//千位
  95   1              disp[1]=smgduan[num%1000/100];//百位
  96   1              disp[2]=smgduan[num%1000%100/10];//个位
  97   1              disp[3]=smgduan[num%1000%100%10];               
  98   1      }
  99          
 100          
 101          /*******************************************************************************
 102          * 函数名         :DigDisplay()
 103          * 函数功能               :数码管显示函数
 104          * 输入           : 无
 105          * 输出           : 无
 106          *******************************************************************************/
 107          void DigDisplay()
 108          {
 109   1              u8 i;
 110   1              for(i=0;i<4;i++)
 111   1              {
 112   2                      switch(i)        //位选，选择点亮的数码管，
 113   2                      {
 114   3                              case(0):
 115   3                                      LSA=0;LSB=0;LSC=0; break;//显示第0位
 116   3                              case(1):
C51 COMPILER V9.01   MAIN                                                                  08/23/2016 14:42:02 PAGE 3   

 117   3                                      LSA=1;LSB=0;LSC=0; break;//显示第1位
 118   3                              case(2):
 119   3                                      LSA=0;LSB=1;LSC=0; break;//显示第2位
 120   3                              case(3):
 121   3                                      LSA=1;LSB=1;LSC=0; break;//显示第3位    
 122   3                      }
 123   2                      P0=disp[i];//发送数据
 124   2                      delay(100); //间隔一段时间扫描  
 125   2                      P0=0x00;//消隐
 126   2              }               
 127   1      }
 128          
 129          /*******************************************************************************
 130          * 函 数 名       : main
 131          * 函数功能               : 主函数
 132          * 输    入       : 无
 133          * 输    出       : 无
 134          *******************************************************************************/
 135          void main()
 136          {       
 137   1              while(1)
 138   1              {
 139   2                      Keypros();       //按键处理函数
 140   2                      datapros();      //数据处理函数
 141   2                      DigDisplay();//数码管显示函数           
 142   2              }               
 143   1      }
 144          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    316    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
