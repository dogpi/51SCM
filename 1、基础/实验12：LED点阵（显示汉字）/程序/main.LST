C51 COMPILER V9.01   MAIN                                                                  08/22/2016 13:51:15 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: J:\mdk4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             LED点阵--显示汉字实验                                                                                               *
   3          实现现象：下载程序后，按照光盘内操作视频接线，LED点阵显示汉字
   4          
   5                                  
   6          注意事项：必须将74HC595模块的JP595短接片短接，否则不会出现现象                                                                                                                                                            
   7          ***************************************************************************************/
   8          
   9          #include "reg51.h"                       //此文件中定义了单片机的一些特殊功能寄存器
  10          #include "intrins.h"
  11          
  12          typedef unsigned int u16;         //对数据类型进行声明定义
  13          typedef unsigned char u8;
  14          
  15          //--定义使用的IO口--//
  16          sbit SRCLK=P3^6;
  17          sbit RCLK=P3^5;
  18          sbit SER=P3^4;
  19          
  20          //定义LED点阵的位选，也就是类似于数码管的位选，因为要对其动态扫描操作
  21          //数组前16位和后16位数据正好是相反的，也就是说先让第3个595输出低电平，然后再让第4个595输出低电平
  22          
  23          u8 code ledwei[]=
  24          {
  25          0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  26          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 
  27          };
  28          
  29          
  30          
  31          u8 code ledduan1[]=
  32          {
  33          /*--  文字:  普  --*/
  34          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  35          0x40,0x44,0x54,0x64,0x45,0x7E,0x44,0x44,0x44,0x7E,0x45,0x64,0x54,0x44,0x40,0x00,
  36          0x00,0x00,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0x49,0x49,0xFF,0x00,0x00,0x00,0x00,
  37          };
  38          
  39          u8 code ledduan2[]=
  40          {
  41          /*--  文字:  中  --*/
  42          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  43          0x00,0x00,0xF0,0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0xF0,0x00,0x00,0x00,
  44          0x00,0x00,0x0F,0x04,0x04,0x04,0x04,0xFF,0x04,0x04,0x04,0x04,0x0F,0x00,0x00,0x00,
  45          };
  46          
  47          
  48          
  49          /*******************************************************************************
  50          * 函 数 名         : delay
  51          * 函数功能                 : 延时函数，i=1时，大约延时10us
  52          *******************************************************************************/
  53          void delay(u16 i)
  54          {
  55   1              while(i--);     
C51 COMPILER V9.01   MAIN                                                                  08/22/2016 13:51:15 PAGE 2   

  56   1      }
  57          
  58          /*******************************************************************************
  59          * 函 数 名         : Hc595SendByte(u8 dat1,u8 dat2,u8 dat3,u8 dat4)
  60          * 函数功能                 : 通过595发送四个字节的数据
  61          * 输    入         : dat1：第4个595输出数值
  62          *                  * dat2: 第3个595输出数值
  63          *                  * dat3：第2个595输出数值
  64          *                  * dat4：第1个595输出数值
  65          * 输    出         : 无
  66          *******************************************************************************/
  67          void Hc595SendByte(u8 dat1,u8 dat2,u8 dat3,u8 dat4)
  68          {
  69   1              u8 a;
  70   1      
  71   1              SRCLK = 1;
  72   1              RCLK = 1;
  73   1      
  74   1              for(a=0;a<8;a++)                 //发送8位数
  75   1              {
  76   2                      SER = dat1 >> 7;                 //从最高位开始发送
  77   2                      dat1 <<= 1;
  78   2      
  79   2                      SRCLK = 0;                       //发送时序
  80   2                      _nop_();
  81   2                      _nop_();
  82   2                      SRCLK = 1;      
  83   2              }
  84   1      
  85   1              for(a=0;a<8;a++)                 //发送8位数
  86   1              {
  87   2                      SER = dat2 >> 7;                 //从最高位开始发送
  88   2                      dat2 <<= 1;
  89   2      
  90   2                      SRCLK = 0;                       //发送时序
  91   2                      _nop_();
  92   2                      _nop_();
  93   2                      SRCLK = 1;      
  94   2              }
  95   1      
  96   1              for(a=0;a<8;a++)                 //发送8位数
  97   1              {
  98   2                      SER = dat3 >> 7;                 //从最高位开始发送
  99   2                      dat3 <<= 1;
 100   2      
 101   2                      SRCLK = 0;                       //发送时序
 102   2                      _nop_();
 103   2                      _nop_();
 104   2                      SRCLK = 1;      
 105   2              }
 106   1      
 107   1              for(a=0;a<8;a++)                 //发送8位数
 108   1              {
 109   2                      SER = dat4 >> 7;                 //从最高位开始发送
 110   2                      dat4 <<= 1;
 111   2      
 112   2                      SRCLK = 0;                       //发送时序
 113   2                      _nop_();
 114   2                      _nop_();
 115   2                      SRCLK = 1;      
 116   2              }
 117   1      
C51 COMPILER V9.01   MAIN                                                                  08/22/2016 13:51:15 PAGE 3   

 118   1              RCLK = 0;
 119   1              _nop_();
 120   1              _nop_();
 121   1              RCLK = 1;
 122   1      }
 123          
 124          
 125          /*******************************************************************************
 126          * 函 数 名       : main
 127          * 函数功能               : 主函数
 128          * 输    入       : 无
 129          * 输    出       : 无
 130          *******************************************************************************/
 131          void main()
 132          {       
 133   1              u8 i;
 134   1              
 135   1              while(1)
 136   1              {        
 137   2                      for(i=0;i<16;i++)
 138   2                      {
 139   3                              Hc595SendByte(~ledwei[i+16],~ledwei[i],ledduan1[16+i],ledduan1[i]);
 140   3                              delay(10);
 141   3                      }               
 142   2              }               
 143   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    178    ----
   CONSTANT SIZE    =     96    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
